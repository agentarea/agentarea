# Global configuration
{
    admin 0.0.0.0:2019
    auto_https off
    log {
        level INFO
    }
}

# Main MCP Manager API (port 8000)
mcp-manager.localhost {
    reverse_proxy mcp-manager:8000
    log {
        output stdout
        format console
    }
}

# Direct API access on port 8000
:8000 {
    reverse_proxy mcp-manager:8000
    log {
        output stdout
        format console
    }
}

# Main web endpoint with dynamic service routing
:80 {
    # Root path goes to API
    handle /* {
        reverse_proxy mcp-manager:8000
    }
    
    log {
        output stdout
        format console
    }
}

# Wildcard subdomain routing for MCP services
*.localhost {
    # Extract service name from subdomain
    @not_mcp_manager not host mcp-manager.localhost
    handle @not_mcp_manager {
        # Default fallback to API for now
        # This will be dynamically configured by MCP Manager
        reverse_proxy mcp-manager:8000
    }
    
    # Fallback for mcp-manager subdomain
    handle {
        reverse_proxy mcp-manager:8000
    }
    
    log {
        output stdout
        format console
    }
} 